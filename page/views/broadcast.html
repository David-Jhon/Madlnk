<div class="flex flex-col space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-4xl font-bold text-white tracking-tight">Broadcast Message</h1>
    </div>

    <!-- Broadcast Composer Card -->
    <div class="glass-gradient p-6 rounded-xl card-hover">
        <h2 class="text-xl font-semibold text-white mb-4">Compose Message</h2>

        <!-- Quill Toolbar -->
        <div id="broadcast-toolbar" class="bg-gray-800/80 rounded-t-lg border border-gray-700 pb-2 mb-4">
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <button class="ql-strike"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-blockquote"></button>
                <button class="ql-code-block"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-link"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-spoiler">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
            </span>
        </div>

        <!-- Quill Editor -->
        <div id="broadcast-editor" class="text-white h-48 bg-gray-900/30 rounded-lg border border-gray-700"></div>

        <!-- Media Upload -->
        <div class="mt-6 p-4 bg-gray-900/30 rounded-lg border border-gray-700">
            <h3 class="text-base font-semibold text-white mb-3">Attach Media</h3>
            <div class="flex items-center space-x-4">
                <input type="file" id="media-file-input" class="hidden">
                <label for="media-file-input"
                    class="cursor-pointer px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-medium transition-all duration-300 shadow-lg hover:shadow-blue-500/50 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Select Media
                </label>
                <span id="media-file-name" class="text-gray-400 text-sm">No file chosen</span>
            </div>
            <div class="flex items-center gap-4 my-3">
                <hr class="flex-grow border-t border-gray-700">
                <span class="text-gray-500 text-sm">or</span>
                <hr class="flex-grow border-t border-gray-700">
            </div>
            <div class="flex items-center space-x-4">
                <input type="text" id="media-url-input-field" placeholder="Enter image or video URL..."
                    class="flex-grow p-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:outline-none">
                <button id="attach-url-btn"
                    class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg font-medium transition-all duration-300 shadow-lg hover:shadow-purple-500/50">Attach</button>
            </div>
            <div id="media-preview" class="mt-4"></div>
            <input type="hidden" id="media-file-id">
            <input type="hidden" id="media-url-input">
            <input type="hidden" id="media-type">
        </div>

        <!-- Buttons -->
        <div class="mt-4">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-base font-semibold text-white">Buttons</h3>
                <div class="flex items-center gap-2">
                    <button id="bulk-add-btn" type="button" class="text-gray-400 hover:text-white transition-colors"
                        title="Bulk Add">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Visual Editor Container -->
            <div id="visual-button-editor" class="space-y-2">
                <!-- Rows will be injected here -->
                <div id="button-rows-container" class="space-y-2"></div>

                <!-- Add Row Button -->
                <button id="add-row-btn" type="button"
                    class="w-full py-2 border border-dashed border-gray-700 text-gray-400 hover:border-gray-500 hover:text-white rounded-lg transition-colors flex items-center justify-center gap-1.5 text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Row
                </button>
            </div>

            <!-- Hidden input to store the final JSON -->
            <input type="hidden" id="broadcast-buttons-input" value="[]">
        </div>

        <!-- Bulk Add Modal -->
        <div id="bulk-add-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
            <div class="bg-gray-900 border border-gray-700 p-6 rounded-lg shadow-xl w-full max-w-lg">
                <h3 class="text-xl font-semibold mb-4 text-white">Bulk Add Buttons</h3>
                <p class="text-sm text-gray-400 mb-1">Format: `Label = URL`</p>
                <p class="text-sm text-gray-400 mb-1">Use `+` to add buttons to the same row.</p>
                <p class="text-sm text-gray-400 mb-2">Use a new line for a new row.</p>
                <div class="bg-gray-800 p-2 rounded-lg text-xs text-gray-300 mb-2">
                    <p><strong>Example:</strong></p>
                    <p>Button 1 = https://example.com/1</p>
                    <p>Button 2 = https://example.com/2 + Button 3 = https://example.com/3</p>
                </div>
                <textarea id="bulk-add-textarea"
                    class="w-full h-40 p-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                <div class="flex justify-end gap-4 mt-4">
                    <button id="cancel-bulk-add" type="button"
                        class="px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-500 transition-colors">Cancel</button>
                    <button id="confirm-bulk-add" type="button"
                        class="px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">Add
                        Buttons</button>
                </div>
            </div>
        </div>

        <div class="flex flex-wrap justify-end mt-6 gap-3">
            <!-- Load Actions -->
            <button id="load-btn"
                class="px-5 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-gray-700/50">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-5 h-5"
                    viewBox="0 0 16 16">
                    <path
                        d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5" />
                </svg>
                Load
            </button>

            <!-- Save Actions -->
            <button id="save-template-btn"
                class="px-5 py-2.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg font-medium transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-green-600/50">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-5 h-5"
                    viewBox="0 0 16 16">
                    <path d="M11 2H9v3h2z" />
                    <path
                        d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5m3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4zM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5z" />
                </svg>
                Save as Template
            </button>
            <button id="save-post-btn"
                class="px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-medium transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-blue-600/50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V3">
                    </path>
                </svg>
                Save Post
            </button>

            <!-- Send Actions -->
            <button id="send-test-btn"
                class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg font-medium transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-purple-600/50">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 12H3"></path>
                    <path d="M16 12H12"></path>
                    <path d="M21 12H20"></path>
                    <path d="M7 5l-4 7 4 7"></path>
                    <path d="M17 5l4 7-4 7"></path>
                </svg>
                Send Test
            </button>
            <button id="send-broadcast-btn"
                class="px-5 py-2.5 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white rounded-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-primary/50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
                Send Broadcast
            </button>
        </div>
        <div id="broadcast-status" class="text-right mt-2 text-sm text-gray-400"></div>
    </div>

    <!-- Send Test Modal -->
    <div id="send-test-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-lg shadow-xl w-full max-w-lg">
            <h3 class="text-xl font-semibold mb-4 text-white">Send Test</h3>
            <p class="text-sm text-gray-400 mb-2">Enter recipient IDs/usernames, separated by commas. If left empty, the
                test message will be sent to the owner ID.</p>
            <textarea id="test-recipients-input" placeholder="e.g., 123456789, @username, -1001234567890"
                class="w-full h-32 p-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
            <div class="flex justify-end gap-4 mt-4">
                <button id="cancel-send-test" type="button"
                    class="px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-500 transition-colors">Cancel</button>
                <button id="confirm-send-test" type="button"
                    class="px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">Send
                    Test</button>
            </div>
        </div>
    </div>

    <!-- Load Modal -->
    <div id="load-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-lg shadow-xl w-full max-w-xl">
            <h3 class="text-xl font-semibold mb-4 text-white">Load Content</h3>
            <div class="mb-4 border-b border-gray-700">
                <nav class="flex -mb-px" id="load-tabs">
                    <button data-tab="posts"
                        class="load-tab-btn whitespace-nowrap py-3 px-4 border-b-2 border-transparent font-medium text-sm text-gray-400 hover:text-white hover:border-gray-300 focus:outline-none">
                        Posts
                    </button>
                    <button data-tab="templates"
                        class="load-tab-btn whitespace-nowrap py-3 px-4 border-b-2 border-transparent font-medium text-sm text-gray-400 hover:text-white hover:border-gray-300 focus:outline-none">
                        Templates
                    </button>
                </nav>
            </div>
            <input type="text" id="load-search" placeholder="Search..."
                class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <div id="load-list" class="space-y-2 h-64 overflow-y-auto custom-scrollbar pr-2">
                <!-- Items will be loaded here -->
            </div>
            <div class="flex justify-end gap-4 mt-4">
                <button id="cancel-load" type="button"
                    class="px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-500 transition-colors">Cancel</button>
                <button id="confirm-load" type="button" disabled
                    class="px-4 py-2 rounded-lg bg-primary text-white opacity-50 cursor-not-allowed">Load
                    Selected</button>
            </div>
        </div>
    </div>

    <!-- Save as Template Modal -->
    <div id="save-template-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-lg shadow-xl w-full max-w-lg">
            <h3 class="text-xl font-semibold mb-4 text-white">Save as Template</h3>
            <p class="text-sm text-gray-400 mb-2">Enter a name for your template.</p>
            <input type="text" id="template-name-input" placeholder="e.g., Weekly Update"
                class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <div class="flex justify-end gap-4 mt-4">
                <button id="cancel-save-template" type="button"
                    class="px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-500 transition-colors">Cancel</button>
                <button id="confirm-save-template" type="button"
                    class="px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">Save</button>
            </div>
        </div>
    </div>
</div>
</div>
<style>
    .ql-snow .ql-stroke {
        stroke: #9ca3af;
    }

    .ql-snow .ql-fill {
        fill: #9ca3af;
    }

    .ql-snow .ql-picker-label {
        color: #9ca3af;
    }

    .ql-snow .ql-tooltip {
        background-color: #1f2937;
        border: 1px solid #374151;
        color: white;
    }

    .ql-snow .ql-tooltip input {
        background-color: #374151;
    }

    .ql-snow .ql-tooltip a.ql-action::after {
        border-right: 0;
        padding-right: 0;
        content: 'Save';
    }

    .ql-snow .ql-tooltip a.ql-remove::before {
        content: 'Remove';
    }

    #broadcast-toolbar .ql-spoiler svg {
        vertical-align: middle;
    }

    .ql-editor tg-spoiler {
        background: #2d3748;
        color: transparent;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        border-radius: 4px;
        padding: 0 4px;
        cursor: pointer;
        user-select: none;
        transition: all 0.15s ease-in-out;
    }

    .ql-editor tg-spoiler.revealed {
        background: transparent;
        color: inherit;
        text-shadow: none;
    }

    #broadcast-toolbar .ql-formats {
        margin-right: 5px;
    }

    #broadcast-toolbar .ql-formats button {
        margin-right: 0;
    }

    /* Monospace-Code */
    #broadcast-editor .ql-editor code {
        background-color: #2d3748;
        color: #e2e8f0;
        border-radius: 3px;
        padding: 2px 4px;
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
    }

    /* Visual Button Editor */
    .button-row-card {
        border: 1px solid #374151;
        border-radius: 0.5rem;
        padding: 0.625rem;
        transition: border-color 0.15s ease-in-out;
    }

    .button-row-card:hover {
        border-color: #4b5563;
    }

    .button-item {
        background: #2d3748;
        border: 1px solid #4b5563;
        border-radius: 0.375rem;
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.375rem;
        flex: 1 1 calc(33.333% - 1rem);
        max-width: calc(33.333% - 1rem);
        min-width: 150px;
        position: relative;
    }

    .button-item .handle-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2rem;
        cursor: grab;
    }

    .button-item:active .handle-overlay {
        cursor: grabbing;
    }

    .button-item input {
        background-color: #1f2937;
        border: 1px solid #4b5563;
        color: #e2e8f0;
        padding: 0.375rem 0.5rem;
        border-radius: 0.25rem;
        width: 100%;
        font-size: 0.875rem;
        transition: border-color 0.15s;
    }

    .button-item input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
    }

    .sortable-ghost {
        opacity: 0.4;
        background: #374151;
        border-style: dashed;
    }

    .sortable-drag {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        transform: scale(1.03);
        z-index: 10;
    }

    .row-handle {
        cursor: grab;
        color: #6b7280;
        transition: color 0.2s;
    }

    .row-handle:hover {
        color: #9ca3af;
    }

    .row-handle:active {
        cursor: grabbing;
    }

    .ql-tooltip {
        z-index: 1000 !important;
        left: 0 !important;
        top: auto !important;
        position: absolute !important;
    }
</style>
<script>
    // This script will be populated by router.js
</script>